
CREATE TABLE REGIONY_SLA (
  REGION_ID   VARCHAR2(10)   CONSTRAINT PK_REGIONY_SLA PRIMARY KEY,
  NAZWA_MIASTA VARCHAR2(100) CONSTRAINT NN_REGIONY_NAZWA NOT NULL
);


CREATE TABLE KLIENCI (
  KLIENT_ID       NUMBER        CONSTRAINT PK_KLIENCI PRIMARY KEY,
  IMIE            VARCHAR2(50)   CONSTRAINT NN_KLIENCI_IMIE NOT NULL,
  NAZWISKO        VARCHAR2(80)   CONSTRAINT NN_KLIENCI_NAZW NOT NULL,
  WIEK            NUMBER(3)      CONSTRAINT CK_KLIENCI_WIEK CHECK (WIEK BETWEEN 0 AND 120),
  STAZ_MIES       NUMBER(5)      DEFAULT 0 CONSTRAINT CK_KLIENCI_STAZ CHECK (STAZ_MIES >= 0),
  KARNET_STATUS   CHAR(1)        DEFAULT 'A' CONSTRAINT CK_KLIENCI_KARNET CHECK (KARNET_STATUS IN ('A','N')),
  REGION_ID       VARCHAR2(10)   CONSTRAINT NN_KLIENCI_REGION NOT NULL,
  DATA_DOLACZENIA DATE          DEFAULT SYSDATE CONSTRAINT NN_KLIENCI_DATA NOT NULL,
  CONSTRAINT FK_KLIENCI_REGION FOREIGN KEY (REGION_ID) REFERENCES REGIONY_SLA(REGION_ID)
);


CREATE SEQUENCE SEQ_KLIENCI_ID
  START WITH 1
  INCREMENT BY 1
  NOCACHE;


CREATE OR REPLACE TRIGGER TRG_KLIENCI_BI
BEFORE INSERT ON KLIENCI
FOR EACH ROW
BEGIN
  IF :NEW.KLIENT_ID IS NULL THEN
    SELECT SEQ_KLIENCI_ID.NEXTVAL INTO :NEW.KLIENT_ID FROM DUAL;
  END IF;
END;
/
